<html lang="en"> <% # https://jqueryui.com/datepicker/ %>
<head>  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Datepicker - Default functionality</title>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
  <script>
    $( function() {
    var dateFormat = "mm/dd/yy",
      from = $( "#from" )
        .datepicker({
          changeMonth: true,
          changeYear: true,
          numberOfMonths: 2,
          minDate: 0
        })
        .on( "change", function() {
          to.datepicker( "option", "minDate", getDate( this ) );
        }),

      to = $( "#to" ).datepicker({
        changeMonth: true,
        changeYear: true,
        numberOfMonths: 2,
        minDate: 0
      })
      .on( "change", function() {
        from.datepicker( "option", "maxDate", getDate( this ) );
      });
 
    function getDate( element ) {
      var date;
      try {
        date = $.datepicker.parseDate( dateFormat, element.value );
      } catch( error ) {
        date = null;
      }
 
      return date;
    }
  } );
  </script>
</head>

<div class="container w-50 my-5">
  <div class="row w-80">
    <form id='form' action="/search" method="GET" class="input-group">
    
        <div class="col-2 px-1 mx-auto">
        <label for="Start" class="form-label">Start date:</label>
        <input type="text" id="from" name="start_date" class="form-control"
         value="<%= params[:start_date] %>">
        </div>

        <div class="col-2 px-1 mx-auto">
        <label for="Start" class="form-label">End date:</label>
        <input type="text" id="to" name="end_date" class="form-control"
         value="<%= params[:end_date] %>">
        </div>

      <div class="col-2 px-1 mx-auto">
        <label for="min_price" class="form-label">Min price:</label>
        <input type="number" name="min_price" id="min_price" class="form-control" 
        min=0 value="<%= params[:min_price] %>" placeholder="Min price" >
      </div>

      <div class="col-2 px-1 mx-auto">
        <label for="max_price" class="form-label">Max price: </label>
        <input type="number" name="max_price" id="max_price" class="form-control" 
        min=0 value="<%= params[:max_price] %>" placeholder="Max price">
      </div>
      
      <div class="col-3 mx-auto">
       <label for="location" class="form-label">Location: </label>
       <div class="d-flex flex-direction-row">
        <input type="search" class="form-control" name="location" placeholder="Location" id="location" value="<%= params[:location] %>">
        <button class="btn btn-dark" type="submit"><i class="fas fa-search" style="font-size: 15px"></i></button>
        </div>
      </div>
    </form>
  </div>
</div>


<div class="container">
  <div class="row">
    <% if @bnbs %>
      <% @bnbs.each do |bnb| %>
            <div class="col-3 my-2 mx-auto text-align-center">
              <div class="card" style="width: 18rem;">
                <img src="https://picsum.photos/300/200" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title text-truncate"><%= bnb.name %></h5>
                  <p class="card-text"><small class="text-muted">Location: <%= bnb.location %></small></p>
                  <p class="card-text"><small class="text-muted">Price: $<%= bnb.price %></small></p>
                  <p class="card-text" style="height: 100px;"><%= truncate(bnb.description) %></p>

                 <a href="/listings/bnb/<%= bnb.bnb_id %><%= "?start_date=#{params[:start_date]}&end_date=#{params[:end_date]}" %>" class="btn btn-dark">Stay here!</a>
                </div>
              </div>
            </div>
      <% end %>
    <% else %>
    <div class="col-12 mt-5">
    <p class="display-4">Sorry, no spaces available.</p>
    <p>Try adjusting your search by changing your dates or by removing filters. Or..</p>
    <div class="col-12 mx-auto d-flex justify-content-center mt-3">
          <a class="btn btn-dark m-2 hero-button" aria-current="page" href="/listings/all" style="font-size: 30px">Get inspired</a>
    </div>
    <% end %>
    </div>
  </div>
</html>
